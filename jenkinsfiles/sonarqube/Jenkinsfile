pipeline {
	agent any
	environment {
    	SQ_TOKEN = credentials('aem-sonarqube-token')
    }
    parameters {
    	string(name: 'branch', defaultValue: 'master')
    }
	stages {
		stage('Clone sources') {
			steps {
				git credentialsId: '93e9e1ee-2e49-484a-9dda-876c2d8f8db0',
					url: 'git@github.com:ComparetheMarket/market.aem-proof-of-concept.git',
					branch: params.branch
			}
		}
		stage('Sonarqube') {
			steps {
				sh "./gradlew -S -i clean sonarqube -Dsonar.login=${SQ_TOKEN}"
			}
		}
	}
}
